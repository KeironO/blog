{{ define "main" }}
<style>
.post-title-box,
.toc-title-box {
  background-color: #000 !important;
  color: #fff !important;
  padding: 12px 16px;
  display: inline-block;
  margin-bottom: 1em;
}

.toc-container h4 {
  color: #fff !important;
}

@media (prefers-color-scheme: dark) {
  .post-title-box,
  .toc-title-box {
    background-color: #fff !important;
    color: #000 !important;
  }

  .toc-container h4 {
    color: #000 !important;
  }
}
</style>
<content>
  <div class="post-wrapper{{ if eq .Section "blog" }} blog-post{{ end }}">
    <h1 class="post-title-box">{{ .Title }}</h1>

    {{ if .Description }}
    <div class="subtitle-container">
      <h3 class="post-subtitle">{{ .Description }}</h3>
    </div>
    {{ end }}

    {{ if .Params.tags }}
    <div class="tags">
      {{ range .Params.tags }}
      <a href="{{ "/tags/" | relURL }}{{ . | urlize }}" class="tag">#{{ . }}</a>
      {{ end }}
    </div>
    {{ end }}

    <div class="post-meta">
      <time datetime='{{ .Date.Format "2006-01-02" }}'>
        {{ .Date.Format (default "02 Jan, 2006" .Site.Params.dateFormat) }}
      </time>
      <span class="reading-time">â€¢ {{ .ReadingTime }} min read</span>
    </div>
    <hr class="subtitle-rule">
    
    {{ $toc := .TableOfContents }}
    {{ if and $toc (not (eq $toc "<nav id=\"TableOfContents\"></nav>")) (eq .Section "blog") }}
    <div class="toc-sidebar">
      <div class="toc-container">
        <h4 class="toc-title-box">Table of Contents</h4>
        <div class="toc">
          {{ $toc }}
        </div>
      </div>
    </div>
    {{ end }}
    
    {{ .Content }}
  </div>
  
  {{ if eq .Section "blog" }}
  {{ partial "social_sharing.html" . }}
  {{ end }}

  {{ if and (eq .Section "blog") (eq .Site.BaseURL "https://keiron.xyz") }}
  <div id="comments-section">
    <h2 style="margin-top: 2em; margin-bottom: 1em;">Reader Engagement Zone</h2>
    <script defer src="https://cdn.commento.io/js/commento.js"></script>
    <div id="commento"></div>
  </div>
  {{ end }}

  {{ if eq .Section "blog" }}
  {{ partial "recommended_posts.html" . }}
  {{ end }}

  {{ if .Site.Params.enablePostNavigator }}
  {{ partial "post_navigator.html" . }}
  {{ end }}
</content>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const truisms = [
    'we live in a society',
    'it is what it is',
    'at the end of the day',
    'thoughts and prayers',
    'solidarity forever',
    'another world is possible',
    'no war but class war',
    'workers of the world unite',
    'the personal is political',
    'no ethical consumption under capitalism',
    'read theory',
    'late stage capitalism',
    'seize the means of production',
    'false consciousness',
    'educate, agitate, organize',
    'educate, agitate, organise',
    'from each according to their ability',
    'the means of production',
    'material conditions',
    'revolutionary praxis',
    'bourgeois democracy',
    'for the many not the few',
    'nationalise the railways',
    'nationalise the utilities',
    'democratic socialism',
    'trade union movement',
    'working class solidarity',
    'general strike',
    'broad church',
    'clause four',
    'public ownership',
    'common ownership',
    'mixed economy',
    'welfare state',
    'social safety net',
    'austerity kills',
    'tory cuts',
    'managed decline',
    'red wall',
    'left behind communities',
    'levelling up',
    'race to the bottom',
    'collective bargaining',
    'right to buy',
    'council housing',
    'social housing',
    'privatisation',
    'neoliberalism',
    'third way',
    'blairism',
    'triangulation',
    'electability',
    'electable',
    'unelectable',
    'social justice',
    'economic justice',
    'wealth redistribution',
    'progressive taxation',
    'public services',
    'save our nhs',
    'defend the nhs',
    'winter of discontent',
    'miners strike',
    'picket line',
    'bedroom tax',
    'universal credit',
    'zero hours contracts',
    'precarious work',
    'gig economy',
    'living wage',
    'real living wage'
  ].sort((a, b) => b.length - a.length); // Sort by length, longest first

  const postContent = document.querySelector('.post-wrapper');
  if (!postContent) return;

  const walker = document.createTreeWalker(
    postContent,
    NodeFilter.SHOW_TEXT,
    {
      acceptNode: function(node) {
        // Skip if parent is already a mark tag or is a script/style
        if (node.parentElement.tagName === 'MARK' ||
            node.parentElement.tagName === 'SCRIPT' ||
            node.parentElement.tagName === 'STYLE') {
          return NodeFilter.FILTER_REJECT;
        }
        return NodeFilter.FILTER_ACCEPT;
      }
    }
  );

  const textNodes = [];
  while (walker.nextNode()) {
    textNodes.push(walker.currentNode);
  }

  textNodes.forEach(node => {
    let text = node.textContent;
    let modified = false;
    let newHTML = text;

    truisms.forEach(truism => {
      const escapedTruism = truism.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
      const regex = new RegExp(`\\b(${escapedTruism})\\b`, 'gi');
      if (regex.test(newHTML)) {
        newHTML = newHTML.replace(regex, '<mark style="background-color: #fff3cd; padding: 2px 4px;">$1</mark>');
        modified = true;
      }
    });

    if (modified) {
      const span = document.createElement('span');
      span.innerHTML = newHTML;
      node.parentNode.replaceChild(span, node);
    }
  });
});
</script>
{{ end }}