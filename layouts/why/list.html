{{ define "main" }}
<content>
  {{ with .Content }}
  <div style="margin-bottom: 30px;">
    {{ . }}
  </div>
  {{ end }}

  {{ if .Pages }}
    <div style="display: flex; flex-direction: column; gap: 16px;">
    {{ range .Pages }}
      {{ $firstSentence := "" }}
      {{ if .Description }}
        {{ $firstSentence = .Description }}
      {{ else if .Summary }}
        {{ $firstSentence = .Summary }}
      {{ else }}
        {{ $content := .Plain }}
        {{ $sentence := findRE `[^.!?]*[.!?]` $content 1 }}
        {{ if $sentence }}
          {{ $firstSentence = index $sentence 0 }}
        {{ else }}
          {{ $firstSentence = truncate 150 $content }}
        {{ end }}
      {{ end }}

      {{ $firstImage := "" }}
      {{ $imageRegex := findRE `(?:src="([^"]+)"|!\[.*?\]\(([^)]+)\))` .Content 1 }}
      {{ if $imageRegex }}
        {{ $match := index $imageRegex 0 }}
        {{ if findRE `src="` $match }}
          {{ $firstImage = replaceRE `.*src="([^"]+)".*` "$1" $match }}
        {{ else }}
          {{ $firstImage = replaceRE `.*\(([^)]+)\).*` "$1" $match }}
        {{ end }}
      {{ end }}

      <div class="index-card" style="
          background: #fff1e6;
          border: 3px solid #000;
          padding: 24px;
          transition: background-color 0.2s ease;
          cursor: pointer;
          display: flex;
          gap: 20px;
          align-items: stretch;
      " onmouseover="this.style.backgroundColor='#ffede0'" onmouseout="this.style.backgroundColor='#fff1e6'" onclick="window.location.href='{{ .Permalink }}'">
        <div style="flex: 1; min-width: 0; display: flex; flex-direction: column; justify-content: center;">
          <div>
            <h2 style="margin: 0 0 12px 0; font-size: 1.8em; font-weight: bold; color: #000;">
              {{ .Title }}
            </h2>
            <p style="margin: 0; color: #333; line-height: 1.6; font-size: 1em;">
              {{ $firstSentence | plainify | truncate 400 }}
            </p>
          </div>
        </div>
        {{ if $firstImage }}
        <div style="flex: 1; min-width: 0; overflow: hidden;">
          <img src="{{ $firstImage }}" alt="" style="width: 100%; height: 100%; display: block; border: 2px solid #000; object-fit: cover;">
        </div>
        {{ end }}
      </div>
    {{ end }}
    </div>
  {{ else }}
    <p>No posts yet</p>
  {{ end }}
</content>
{{ end }}
